<%= component_wrapper do %>
  <%= primer_form_with(
    id: FORM_ID,
    model: WorkPackage.new,
    **submit_url_options,
    data: {
      turbo: true,
      update_work_package: true
    }
    ) do |f| %>
    <%# Form fields section %>
    <%= flex_layout(my: 3) do |flex|
        flex.with_row do
          if @base_errors&.any?
            render(Primer::Alpha::Banner.new(mb: 3, icon: :stop, scheme: :danger)) { @base_errors.join("\n") }
          end
        end
        flex.with_row do
          # @workpackage is not available inside the render_inline_form block
          # so we need to re-define them here. Figure out solution for this.
          ancestors_id = @work_package.ancestors.pluck(:id)
          children_id = @work_package.children.pluck(:id)
          non_relatable_wp_ids = [@work_package.id] + ancestors_id + children_id
          render_inline_form(f) do |my_form|
            my_form.work_package_autocompleter(
              name: :id,
              label: WorkPackage.model_name.human,
              visually_hide_label: false,
              autocomplete_options: {
                resource: 'work_packages',
                searchKey: 'subjectOrId',
                openDirectly: false,
                focusDirectly: true,
                dropdownPosition: 'bottom',
                appendTo: "##{DIALOG_ID}",
                filters: [{ name: "id", operator: "!", values:  non_relatable_wp_ids}],
                data: { test_selector: ID_FIELD_TEST_SELECTOR }
              }
            )
          end
        end
      end %>
  <% end %>
<% end %>
