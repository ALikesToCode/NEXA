<%= render(Primer::OpenProject::PageHeader.new) do |header| %>
  <% header.with_title(variant: :large, data: { 'test-selector': 'project-query-name'}) { page_title } %>

  <% header.with_actions do %>
    <%= render(
          Primer::Beta::Button.new(
            tag: :a,
            href: activities_path,
            size: :medium,
            type: :submit,
            aria: { label: t(:label_overall_activity) },
            mr: BUTTON_MARGIN_RIGHT
          )
        ) do
          t(:label_overall_activity)
        end
    %>

    <%= render(
          Primer::Beta::Button.new(
            tag: :a,
            href: gantt_portfolio_query_link,
            size: :medium,
            disabled: gantt_portfolio_project_ids.empty?,
            type: :submit,
            aria: { label: t('projects.index.open_as_gantt') },
            mr: BUTTON_MARGIN_RIGHT,
            id: 'projects-index-open-as-gantt',
            target: '_blank'
          )
        ) do |button|
          button.with_leading_visual_icon(icon: 'op-view-timeline')
          button.with_trailing_visual_icon(icon: 'link-external')
          button.with_tooltip(text: gantt_portfolio_title)

          t('projects.index.open_as_gantt')
        end %>

    <%= render(Primer::Alpha::ActionMenu.new) do |menu|
      menu.with_show_button(icon: 'op-kebab-vertical', 'aria-label': t(:label_more), data: { 'test-selector': 'project-more-dropdown-menu' })

      if current_user.logged?
        menu.with_item(
          label: t('button_save'),
          content_arguments: { 'data-show-dialog-id': SAVE_MODAL_ID }
        ) do |item|
          item.with_leading_visual_icon(icon: :'op-save')
        end
      end

      if current_user.admin?
        menu.with_item(
          label: t('button_configure'),
          href: admin_settings_projects_path,
          content_arguments: { target: '_blank' }
        ) do |item|
          item.with_leading_visual_icon(icon: :gear)
        end
      end

      menu.with_item(
        label: t('js.label_export'),
        content_arguments: { 'data-show-dialog-id': EXPORT_MODAL_ID }
      ) do |item|
        item.with_leading_visual_icon(icon: 'op-file-download')
      end
    end
    %>
  <% end %>
<% end %>

<%= render(Primer::Alpha::Dialog.new(title: 'Save list', id: SAVE_MODAL_ID)) do |d| %>
  <% d.with_header(variant: :large) %>

  <%= primer_form_with(url: projects_queries_path) do %>

    <%= hidden_field_tag :filters, params[:filters] %>

    <%= render(Primer::Alpha::Dialog::Body.new) do %>
      <%= render(Primer::Alpha::TextField.new(name: 'name', label: t(:label_name), required: true, autofocus: true )) %>
    <% end %>

    <%= render(Primer::Alpha::Dialog::Footer.new) do %>
      <%= render(Primer::ButtonComponent.new(type: :submit, scheme: :primary, data: { "close-dialog-id": SAVE_MODAL_ID })) { "Save" } %>
    <% end %>
  <% end %>
<% end %>

<%= render(Primer::Alpha::Dialog.new(title: t('js.label_export'),
                                     id: EXPORT_MODAL_ID)) do |d|
  d.with_header(variant: :large)
  d.with_body do
    render partial: 'project_export_modal', locals: { query: query }
  end
end %>
